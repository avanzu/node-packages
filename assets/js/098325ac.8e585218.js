"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[102],{484:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"kernel/Scaffolding/minimal","title":"Minimal","description":"The code snippets provided represent the absolute minimal codebase that has to be present in order for the kernel to run. As such, they are organized as if everything was in one single file.","source":"@site/docs/kernel/2 - Scaffolding/1-minimal.md","sourceDirName":"kernel/2 - Scaffolding","slug":"/kernel/Scaffolding/minimal","permalink":"/node-packages/docs/kernel/Scaffolding/minimal","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Minimal","sidebar_label":"Minimal"},"sidebar":"kernelSidebar","previous":{"title":"Install","permalink":"/node-packages/docs/kernel/Welcome/install"},"next":{"title":"Hexagonal style","permalink":"/node-packages/docs/kernel/Scaffolding/hexagonal"}}');var o=t(4848),i=t(8453);const a={title:"Minimal",sidebar_label:"Minimal"},s=void 0,l={},c=[{value:"Create boilerplate code",id:"create-boilerplate-code",level:2},{value:"Run your server",id:"run-your-server",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"The code snippets provided represent the absolute minimal codebase that has to be present in order for the kernel to run. As such, they are organized as if everything was in one single file."}),"\n",(0,o.jsx)(n.p,{children:"If that's too messy for your liking, feel free to create indiviual files for each snippet as you see fit."}),"\n",(0,o.jsx)(n.h2,{id:"create-boilerplate-code",children:"Create boilerplate code"}),"\n",(0,o.jsx)(n.p,{children:"Extend interfaces provided by the kernel to simplify tying in your application later on."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"// kernel.ts\n\nimport * as Kernel from '@avanzu/kernel'\n\n// declare configuration options that your application needs\ninterface ConfigValues extends Kernel.ConfigOptions {}\n\ninterface Configuration extends Kernel.Configuration<ConfigValues> {}\n\n// declare services that will be managed by your DIC to help with type safety during development\ninterface Services extends Kernel.AppServices {\n    appLogger: Kernel.Logger,\n    appConfig: Configuration\n}\n\n// extend kernel interfaces to use as shorthand during development\ninterface Container extends Kernel.Container<Services> {}\ninterface State extends Kernel.AppState<Container> {}\ninterface Context extends Kernel.AppContext<Container, State> {}\ninterface App extends Kernel.App<Container, State, Context> {}\n"})}),"\n",(0,o.jsx)(n.p,{children:"You will need to provide an implementation for the Configuration interface."}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"Config"})," class centralizes application settings, enabling consistent configuration management across the application.\nIt simplifies access to configuration values and supports environment-specific settings, enhancing maintainability and scalability."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"minimal example"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"export class Config implements Kernel.Configuration<ConfigValues> {\n    constructor(protected values: ConfigValues) {}\n\n    get<P extends keyof ConfigValues>(key: P): ConfigValues[P] {\n        if (!(key in this.values) || null == this.values[key]) {\n            throw new Error(`Key ${key} is not configured`)\n        }\n        return this.values[key]\n    }\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"Next, you need to create your container builder."}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"ContainerBuilder"})," class facilitates dependency injection by managing the creation and lifecycle of application components. It ensures that dependencies are provided efficiently and promotes loose coupling, making the application easier to test and extend."]}),"\n",(0,o.jsxs)(n.p,{children:["For detailed instructions on how to register dependencies, see the ",(0,o.jsx)(n.a,{href:"https://github.com/jeffijoe/awilix",children:"awilix"})," and the ",(0,o.jsx)(n.a,{href:"https://github.com/kibertoad/awilix-manager",children:"awilix-manager"})," documentation."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"\nimport { asValue } from 'awilix'\n\nexport class ContainerBuilder extends Kernel.AbstractContainerBuilder<Container> {\n\n    constructor(protected options: Config, protected logger: Kernel.Logger) {}\n\n    async buildMainContainer(container: Container): Promise<void> {\n        // register dependencies as usual in awilix\n        container.register('appLogger', asValue(this.logger))\n        container.register('appConfig', asValue(this.options))\n    }\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now, yo are able to create your application kernel."}),"\n",(0,o.jsxs)(n.p,{children:["For sake of simplicity, we use the builtin ",(0,o.jsx)(n.code,{children:"PinoLogger"})," as our application logger.\nIf you would prefer a different logging solution, feel free to replace it."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"export class MyProjectKernel extends Kernel.Kernel<Config, App, Container> {\n\n    protected createContainerBuilder(): Kernel.ContainerBuilder {\n        return new ContainerBuilder(this.options, this.logger)\n    }\n\n    protected createLogger(): Kernel.Logger {\n        return new Kernel.PinoLogger({})\n    }\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"With all that in Place, you can start to create your Controllers, UseCases and any service that is required by them."}),"\n",(0,o.jsx)(n.p,{children:"Let's create a simple Controller that acts as a healthcheck."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"@Kernel.Controller()\nexport class AppController {\n\n    @Kernel.Get('/health')\n    async healthCheck(context: Context) {\n        context.body = 'OK'\n    }\n}\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Controllers don't have to be explicitly registered in the DIC. However, you still have to make sure, that the code is present when the application starts so that the application is arware of them."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Finally, you need an entrypoint that creates and launches your application."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:";(async function main() {\n    const config = new Config({\n        host: '0.0.0.0',\n        port: 3000,\n        namespace: '',\n        resources: {}\n    })\n\n    const kernel = new MyProjectKernel(config)\n\n    process.on('SIGTERM', kernel.shutdown.bind(kernel))\n    process.on('SIGINT', kernel.shutdown.bind(kernel))\n\n    try {\n        await kernel.boot()\n    } catch (error) {\n        console.error(error)\n        process.exit(1)\n    }\n\n    try {\n        await kernel.serve()\n    } catch (error) {\n        console.error(error)\n        process.exit(2)\n    }\n})()\n"})}),"\n",(0,o.jsx)(n.h2,{id:"run-your-server",children:"Run your server"}),"\n",(0,o.jsxs)(n.p,{children:["Assuming that you have, in fact, pasted all of the snippets into a single file (",(0,o.jsx)(n.code,{children:"index.ts"}),"), you should now be able to build an launch your application."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"npx tsc && node ./main.js\n"})}),"\n",(0,o.jsx)(n.p,{children:"You should see a log line in your terminal similar to this one"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n    "level": 30,\n    "time": 1716097817769,\n    "pid": 1552845,\n    "hostname": "...",\n    "host": "0.0.0.0",\n    "port": 3000,\n    "url": "http://0.0.0.0:3000",\n    "msg": "Server running"\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"With your server running, you are now able to call your health check.\nYou can use your browser to do so or use something like curl or httpie in your terminal."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"curl -v localhost:3000/health\n*   Trying 127.0.0.1:3000...\n* Connected to localhost (127.0.0.1) port 3000 (#0)\n> GET /health HTTP/1.1\n> Host: localhost:3000\n> User-Agent: curl/7.81.0\n> Accept: */*\n>\n* Mark bundle as not supporting multiuse\n< HTTP/1.1 200 OK\n< Content-Type: text/plain; charset=utf-8\n< Content-Length: 2\n< Date: Sun, 19 May 2024 05:56:00 GMT\n< Connection: keep-alive\n< Keep-Alive: timeout=5\n<\n* Connection #0 to host localhost left intact\nOK\n"})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>s});var r=t(6540);const o={},i=r.createContext(o);function a(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);